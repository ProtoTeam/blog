# 这个月，我就和折线图杠上了...

**TL;DR  **[**G2Plot**](https://github.com/antvis/G2Plot) 是一个注重于细节体验的通用统计图表库。

![image.png](https://cdn.nlark.com/yuque/0/2020/png/86342/1578450784060-d1c4c9fb-3da9-415c-b3a7-3c49f746a8ec.png#align=left&display=inline&height=1970&name=image.png&originHeight=3939&originWidth=2811&size=2941785&status=done&style=none&width=1405.5)


<a name="dwqRj"></a>
## 背景

折线图用于表示连续时间跨度内的数据，它通常用于显示某变量随时间的变化模式：是上升还是下降，是否存在周期性的循环？因此，相对于独立的数据点，折线图关注的是全局趋势。

在折线图中，一般水平轴（X 轴）用来表示时间的推移，并且间隔相同；而垂直轴（Y 轴）代表不同时刻的数据的大小。

折线图适合的数据类型为一个**连续字段**（时间）和一个**离散字段**（数值）。在下面这个例子中，`time`为连续数据字段，`value`为离散数据字段。

在业务上，通常使用折线图来展现一个指标在时间上的趋势情况。譬如：

![image.png](https://cdn.nlark.com/yuque/0/2020/png/86342/1578450783986-3e4bc623-884f-4293-a0fe-2920b28e781d.png#align=left&display=inline&height=517&name=image.png&originHeight=1034&originWidth=2472&size=483154&status=done&style=none&width=1236)

> 上图展示的是某电商平台上，最近 30 天的订单数量趋势。



<a name="WuUjG"></a>
## 体验细琢

G2Plot 对于折线图的细节体验打磨，以下面的几个例子加以说明和对比：

<a name="xmTuJ"></a>
#### 数据标签的碰撞躲避

> 数据标签是对数据点的具体数据的描述，信息价值很高。在多条数据接近的时候，容易数据标签的互相遮挡，形成无效信息，且不美观。


| **echarts** | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576673058980-16fb564b-16be-416d-aeb3-e5b60854ad9f.png#align=left&display=inline&height=384&name=image.png&originHeight=627&originWidth=948&size=220702&status=done&style=none&width=581) | ❌直接遮挡显示 |
| --- | --- | --- |
| **highcharts** | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576673162687-7447285c-913d-4d02-9507-1f0556720133.png#align=left&display=inline&height=412&name=image.png&originHeight=650&originWidth=948&size=196784&status=done&style=none&width=601) | ❌部分情况出现遮挡 |
| **G2Plot** | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576673191716-77c117ab-0596-40c6-8578-a03b9b3b3bc8.png#align=left&display=inline&height=398&name=image.png&originHeight=630&originWidth=948&size=232078&status=done&style=none&width=599) | ✅自动躲避、隐藏<br /><br />25.2 点有问题 |
|  | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576754469550-41a45aa7-d6c3-47cc-88d9-a3fd6097202d.png#align=left&display=inline&height=399&name=image.png&originHeight=633&originWidth=948&size=273774&status=done&style=none&width=598) | ✅超过三条折线，优先显示最大、最小数据的标签 |



<a name="fo4RC"></a>
#### 坐标轴标题和 tick 重叠

| **echarts** | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576069263719-8fea38ed-7afe-4aca-9c4d-825f6d6d4f86.png#align=left&display=inline&height=361&name=image.png&originHeight=722&originWidth=1936&size=187619&status=done&style=none&width=968) | ❌轴标题和轴标签遮挡 |
| --- | --- | --- |
| **G2Plot** | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576069306763-c73d190f-04d3-4a04-8145-c9a28e98f7d4.png#align=left&display=inline&height=360&name=image.png&originHeight=720&originWidth=1950&size=180130&status=done&style=none&width=975) | ✅不会出现信息遮挡 |


通过改造组件布局，永久解决轴标题和轴 tick 的重叠问题。


<a name="5DDhd"></a>
#### 缩略轴标签显示不全
> 对于数据较多的情况，我们会使用缩略轴组件，即可以看到局部数据，也可以看到全局的趋势。


| **echarts** | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576068656353-d9886330-137b-4ffb-9a6b-efc855fdaa59.png#align=left&display=inline&height=415&name=image.png&originHeight=830&originWidth=1728&size=494388&status=done&style=none&width=864) | ❌缩略轴标签被裁剪，无法看清数据范围

标记一下 |
| --- | --- | --- |
| **G2Plot** | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576068695323-e12d2815-f5a5-427e-8356-27007ad459d2.png#align=left&display=inline&height=411&name=image.png&originHeight=822&originWidth=2152&size=603454&status=done&style=none&width=1076) | ✅不会出现信息遮挡<br />✅缩略轴移动到边缘，自动将标签显示到内部 |



<a name="Mkx1Q"></a>
#### 图例翻页优化

> 在拆分数据较多的情况下，会出现图例项非常多的情况。


| **echarts** | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576122952563-2b32aa88-1d46-4ea6-9172-5df6986e79d2.png#align=left&display=inline&height=492&name=image.png&originHeight=538&originWidth=960&size=1456177&status=done&style=none&width=878) | ❌图例和图形遮挡，信息混杂无效 |
| --- | --- | --- |
| **G2Plot** | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576123010385-2668be3d-7878-464b-8b69-197bba604cfa.png#align=left&display=inline&height=395&name=image.png&originHeight=362&originWidth=960&size=466375&status=done&style=none&width=1048) | ✅限制图例的最大画布区域，防止极限情况下，信息遮挡 |
|  | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576122998744-89da6554-b02e-4e12-a730-2ac6f3e8b91f.png#align=left&display=inline&height=391&name=image.png&originHeight=355&originWidth=960&size=262001&status=done&style=none&width=1056) | ✅增加图例分页，让图例占用少量空间，让用户精力聚焦在图形和数据上 |



<a name="DtZFn"></a>
#### 轴标签遮挡问题

> 在 x 轴标签过多的情况下，会出现标签遮挡，不仅不美观，也会导致信息无效。（点击看大图）


| **原始** | **autoHideLabel: true** | **autoRotateLabel: true** |
| --- | --- | --- |
| ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576756877817-b3881bbe-7223-4781-ab30-ac708c7aa1cd.png#align=left&display=inline&height=425&name=image.png&originHeight=850&originWidth=1298&size=148166&status=done&style=none&width=649) | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576756947967-cefff2e8-6404-46b0-a52b-53151d59ace0.png#align=left&display=inline&height=425&name=image.png&originHeight=850&originWidth=1276&size=131916&status=done&style=none&width=638) | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1576757045325-ee6d12ae-bd02-4bc0-9985-74eb2c2a1437.png#align=left&display=inline&height=424&name=image.png&originHeight=848&originWidth=1284&size=134857&status=done&style=none&width=642) |



<a name="ItZRe"></a>
## 体验增强

<a name="Yodrb"></a>
#### 增强一：时间轴优化

> 折线图主要用于做指标趋势，所以其 X 轴绝大多是情况都是时间类型。G2Plot 对 X 轴是时间情况下，做一个轴标签显示的优化，既可以降低冗余信息的展示，又可以节约画布空间。


![image.png](https://cdn.nlark.com/yuque/0/2020/png/86342/1578450784004-6aac3681-240a-488a-8c89-0dbcef4e13df.png#align=left&display=inline&height=323&name=image.png&originHeight=646&originWidth=1138&size=55268&status=done&style=shadow&width=569)<br />

敬请期待：通过事件轴标签的分层，可以让信息展示更加清晰明了。

<a name="hvNdP"></a>
#### 增强二：跟随图例

在多折线情况下，使用跟随图例的形式，去标识出折线所属于的维值信息，直观有效。

![1578106109655-eed7980f-4893-4d49-8778-b9d6e287059f.gif](https://cdn.nlark.com/yuque/0/2020/gif/86342/1578450784022-e62948b6-e8c6-4128-9733-89b2e8addea3.gif#align=left&display=inline&height=453&name=1578106109655-eed7980f-4893-4d49-8778-b9d6e287059f.gif&originHeight=469&originWidth=600&size=591602&status=done&style=none&width=579)

<a name="qCo4a"></a>
#### 增强三：海量数据的交互增强

> 使用缩略轴的方式去缩放和显示数据，并且缩略轴的标签文本在边缘处会自动切换到内部显示，防止被遮挡。


✅**使用缩略轴组件**

![Dec-19-2019 17-45-41.gif](https://cdn.nlark.com/yuque/0/2020/gif/86342/1578450784037-e0ee9114-f1a4-4d5f-a505-2c2d29bb1848.gif#align=left&display=inline&height=471&name=Dec-19-2019%2017-45-41.gif&originHeight=532&originWidth=842&size=1620368&status=done&style=shadow&width=746)

✅**使用滚动条组件**

![Dec-19-2019 19-48-25.gif](https://cdn.nlark.com/yuque/0/2020/gif/86342/1578450784036-2bd6ae4a-016c-47aa-ba6b-17f6f895b035.gif#align=left&display=inline&height=408&name=Dec-19-2019%2019-48-25.gif&originHeight=472&originWidth=862&size=480214&status=done&style=shadow&width=746)


<a name="ORyR8"></a>
#### 增强四：特殊数据区间，数据点标记

![image.png](https://cdn.nlark.com/yuque/0/2020/png/86342/1578450784055-99d9dc8c-f50c-47d7-8ac5-8edf37a16d08.png#align=left&display=inline&height=401&name=image.png&originHeight=922&originWidth=1472&size=348625&status=done&style=shadow&width=641)

敬请期待：可以标记出特殊的时间区间，比如周末，节假日等，另外也可以对一些数据点进行数据标签标记说明。

<a name="MKtef"></a>
#### 增强五：数据标记点、线、区间

| ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1577067179622-ad8efcf8-6f8d-4893-811b-21a4d81537f8.png#align=left&display=inline&height=217&name=image.png&originHeight=419&originWidth=666&size=314843&status=done&style=shadow&width=345) | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1577067214776-4dc47473-5a9b-47c9-a259-54815acb9f10.png#align=left&display=inline&height=215&name=image.png&originHeight=406&originWidth=658&size=361266&status=done&style=shadow&width=348) |
| --- | --- |


敬请期待：对一些特殊的重点事件时间进行标记，让用户更加清晰的感知到数据趋势变化的原因。

<a name="x6d3o"></a>
#### 增强六：预警线、预警区间

| ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1577067268425-4230895f-dc70-4126-94ec-9d054ae75225.png#align=left&display=inline&height=281&name=image.png&originHeight=409&originWidth=650&size=184148&status=done&style=shadow&width=446) | ![image.png](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/32213/1577067292322-afc9b9e4-e31e-4176-9de2-5167197694d8.png#align=left&display=inline&height=463&name=image.png&originHeight=410&originWidth=654&size=218037&status=done&style=none&width=739) |
| --- | --- |


敬请期待：对于实时监控类的数据，通过预警线、预警区间的辅助元素，让超阈值数据明显的标记出来。

<a name="Trelv"></a>
#### 增强七：面积图 AreaLabel

![image.png](https://cdn.nlark.com/yuque/0/2020/png/86342/1578450784052-eb6447ba-12d8-481e-bf5d-61c4aa819dec.png#align=left&display=inline&height=427&name=image.png&originHeight=854&originWidth=1264&size=452491&status=done&style=shadow&width=632)

将数据的分类，直接标记在 Area 面积中间，并且文字大小直接适配面积大小，让用户更加直观的看到不同区块对应的数据类型。


<a name="eDxyd"></a>
## 最后

上述对于折线图的优化点，都沉淀在** **[**G2Plot**](https://github.com/antvis/G2Plot)** **中，并且完全开源。G2Plot 是基于 G2 图形语法基础上，形成的一套注重图表细节体验、易用性的上统计图表库，从中提炼的 [**AntV 设计原则**](https://antv.vision/zh/docs/specification/principles/basic)是基于  Ant Design  设计体系衍生的，具有数据可视化特性的指导原则。它遵循 Ant Design 设计价值观的同时，对数据可视化领域的进一步解读，如色彩、字体的指引。

我们经过大量的项目实践和经验总结，总结了以下四条核心原则，并以重要等级进行排序，四条原则相辅相成且呈递进关系，希望你在设计时也可以采纳：

- **准确**：从数据转化到可视表达时不歪曲，不误导，不遗漏，忠实反映数据里包含的信息。
- **有效**：信息传达有重点，克制不冗余，避免信息过载，用最适量的数据-油墨比（Data-ink Ratio）表达对用户最有用的信息
- **清晰**：表现方式清楚易读，具条理性，可以帮助用户快速达成目标，在最少的时间内获取更多的信息。
- **美**：对数据的完美表达，合理利用视觉元素进行艺术创作，不过度修饰，给用户优雅的体验。

> 最后，非常欢迎参入 issue 讨论或者代码 PR：[https://github.com/antvis/G2Plot](https://github.com/antvis/G2Plot)。


